# TanStack Query를 사용하기 적절한 상황은?

2025-05-19

**Tags:** #TanStack-Query

여러 프로젝트를 개발하면서 TanStack Query를 채택했지만, 제대로 활용하고 있는 게 맞는지 의문이 들어, TanStack Query 사용을 권장할만한 상황과, 오버스펙이 되는 경우를 나누어 정리해봤다.

`TanStack Query`는 단순한 API 요청 라이브러리가 아니라 서버 상태를 캐싱하고 동기화하는 도구이다.
단순 요청보다는 `데이터를 가져오고, 재사용하고, 갱신하고, 동기화해야 하는 상황`에서 사용하는 것이 올바른 활용법이라고 할 수 있다.


## ✅ TanStack Query가 적절한 대표적인 상황

1. 동일 데이터를 여러 컴포넌트에서 공유할 때
	•	예: 사용자 프로필, 공통 설정, 알림 목록 등
	•	서버에서 한 번만 가져오고, 여러 컴포넌트에서 재사용 → 자동 캐싱

2. 반복해서 동일 요청이 발생할 가능성이 있을 때
	•	예: 실시간 검색처럼 빠르게 같은 쿼리를 보낼 수 있는 경우
	•	cacheTime / staleTime 덕분에 불필요한 중복 요청 제거

->  `실시간 검색같이 동일 요청 반복`에 해당되는 케이스

```useQuery(['search', query], () => fetchSearch(query), {
  enabled: query.length > 0,
  staleTime: 3000, // 3초간 캐시 사용
});
```


3. 데이터를 수동으로 갱신해야 하는 상황 (Mutations)
	•	예: 게시글 작성 후 목록 다시 불러오기
	•	useMutation + queryClient.invalidateQueries() 조합으로 자동 리페치


4. 오프라인/포커스 복귀 시 자동 갱신이 필요한 경우
	•	브라우저를 다시 켰을 때 자동으로 데이터를 최신화하고 싶을 때
	•	refetchOnWindowFocus, refetchOnReconnect


5. 페이징, 무한 스크롤, 비동기 리스트
	•	예: 게시글 무한 스크롤
	•	useInfiniteQuery로 손쉽게 구현 가능

## ❌ TanStack Query가 과한 경우
	•	단순한 한 번짜리 요청/응답 (ex. 로그인 요청)
	•	클릭 시 단발성 POST/PUT 요청만 하는 기능
	•	클라이언트 상태만 다루는 상황 (ex. 다크모드 여부, toggle 버튼 등)
→ 이럴 땐 그냥 useState나 zustand, recoil 등이 더 가볍고 빠르다.


## ✅ 요약

TanStack Query는 “요청”보단 “서버 상태 관리”를 위한 도구다.
특히 “중복 요청 방지”, “자동 캐시”, “데이터 동기화”가 중요한 상황에 적합하다.

| 상황                 | 사용 적합성 | 이유                                        |
|----------------------|--------------|---------------------------------------------|
| 실시간 검색          | ✅           | 짧은 주기 반복 요청, 캐싱으로 중복 방지     |
| 마이페이지 공통 데이터 | ✅           | 여러 컴포넌트 간 공유 필요                  |
| 버튼 클릭 후 POST 요청 | ❌           | 단순 요청에 과함                            |
| 무한 스크롤 리스트    | ✅           | `useInfiniteQuery` 최적화 지원             |
| 로그인 요청           | ❌           | 일반 fetch로도 충분                         |
